function convertSpeed(e){var t=-1;do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(1)+" "+["KB","MB","GB","TB","PB","EB","ZB","YB"][t]}var codemirrorEditor,_OBJECT_URL,filename;(parsingurl=new URLSearchParams(window.location.search),page=parsingurl.get("page"),act=parsingurl.get("act"),dir=parsingurl.get("dir"),type=parsingurl.get("type"),file=parsingurl.get("file"),$(".btn-backup").on("click",function(e){if(e.preventDefault(),files=[],$(".cekfiles").each(function(){!0===$(this).is(":checked")&&files.push($(this).val())}),0===files.length)return alert("Belum ada file yang dipilih!"),!1;$(this).html('<i class="fa fa-circle-o-notch fa-spin"></i> Proses Backup'),$("button").attr("disabled",!0),$.post(`${baseurl}`,{backup:"",files:files},function(e){!0===JSON.parse(e).status?window.location.reload():$(this).removeAttr("disabled",!0).html('<i class="fa fa-database"></i> Backup')})}),$("#showpass").on("click",function(e){!0===$(this).is(":checked")?$(".pass").attr("type","text"):$(".pass").attr("type","password")}),"setting"===page&&$("#form-setting").on("submit",function(e){e.preventDefault();var t=$(this);$.ajax({url:`${baseurl}?page=simpan`,type:"post",data:t.serializeArray(),success:function(e){window.location.reload()}})}),loadListDirectory=(()=>{$(".list_directory").html('<div class="mt-3"><div class="box"></div><div class="box"></div><div class="box"></div></div>'),$.get(`${baseurl}?page=list`,{folder:folder},function(e){$(".list_directory").html(e)})}),"edit"!==page&&"confirmation"!==page&&"add"!==page&&loadListDirectory(),"edit"===page)&&($(".loading").show(),$.post(`${baseurl}`,{read_file:"",file:file},function(e){$(".loading").hide(),$("#codearea").fadeIn("slow").show(),document.querySelector("#codearea").value=window.atob(window.atob(window.atob(e))),codemirrorEditor=CodeMirror.fromTextArea(document.getElementById("codearea"),{lineNumbers:!0,theme:"monokai",matchBrackets:!0,mode:{name:"javascript",startOpen:!0},indentUnit:4,indentWithTabs:!0,lineWrapping:!0})}),$(".btn-simpan-file").on("click",function(e){e.preventDefault();var t=$(this),a=codemirrorEditor.getValue(),o=$(".pathfile").val(),r=$(".password").val(),s=new XMLHttpRequest;if(""===r.trim())return toastr.error("Password can't empty!","Warning"),!1;$(this).html('<i class="fa fa-circle-o-notch fa-spin"></i> Saving...').attr("disabled",!0),s.onload=function(){4==this.readyState&&200==this.status?("0"!==this.response?toastr.success("Successfully saved!","Information"):toastr.error("Unsuccessfully saved!","Warning"),t.html('<i class="fa fa-save"></i> Simpan').removeAttr("disabled")):alert("Target server reached, but it returned an error")},s.onerror=function(){},s.open("POST",baseurl,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),s.send("savefile=&path="+o+"&password="+r+"&content="+encodeURIComponent(a))}));("add"===page&&"folder"===type&&$("#form-add-folder").on("submit",function(e){e.preventDefault();var t=$(this);$("button").attr("disabled",!0),$.ajax({url:`${baseurl}`,type:"post",data:t.serializeArray(),dataType:"json",success:function(e){!0===e.status?(toastr.success(e.pesan,"Success"),setTimeout(()=>{window.history.back()},1e3)):(toastr.error(e.pesan,"Warning"),$("button").removeAttr("disabled"))}})}),"add"===page&&"file"===type)&&(codemirrorEditor=CodeMirror.fromTextArea(document.getElementById("codearea"),{lineNumbers:!0,theme:"monokai",matchBrackets:!0,mode:{name:"javascript",startOpen:!0},indentUnit:4,indentWithTabs:!0,lineWrapping:!0}),$("#form-add-file").on("submit",function(e){e.preventDefault();var t=new FormData(this),a=codemirrorEditor.getValue();t.append("content",a),$("button").attr("disabled",!0),$.ajax({url:`${baseurl}`,type:"post",data:t,processData:!1,contentType:!1,dataType:"json",success:function(e){!0===e.status?(toastr.success(e.pesan,"Success"),setTimeout(()=>{window.history.back()},1e3)):(toastr.error(e.pesan,"Warning"),$("button").removeAttr("disabled"))}})}));("confirmation"===page&&$("form").on("submit",function(e){e.preventDefault();var t=$(this),a=$(this).find("button").text(),o=$(this).find("button");o.html(`<i class="fa fa-circle-o-notch fa-spin"></i> ${a}`).attr("disabled",!0),$.ajax({url:`${baseurl}`,type:"post",data:t.serializeArray(),dataType:"json",success:function(e){!0===e.status?(toastr.success(e.pesan,"Success"),setTimeout(()=>{window.history.back()},1e3)):(toastr.error(e.pesan,"Warning"),o.html(`${a}`).removeAttr("disabled"))}})}),null===page&&$("form").on("submit",function(e){e.preventDefault();var t=$(this),a=$(this).find("button").text(),o=$(this).find("button");o.html(`<i class="fa fa-circle-o-notch fa-spin"></i> ${a}`).attr("disabled",!0),$.ajax({url:`${baseurl}`,type:"post",data:t.serializeArray(),dataType:"json",success:function(e){!0===e.status?(toastr.success(e.pesan,"Success"),setTimeout(()=>{window.location.reload()},1e3)):(toastr.error(e.pesan,"Warning"),o.html(`${a}`).removeAttr("disabled"))}})}),"downloadbackup"===page)&&document.querySelector("#download-button").addEventListener("click",function(e){e.preventDefault();var t=$(".password").val();document.querySelector("#download-button").setAttribute("disabled","disabled"),$.post(`${baseurl}`,{downloadbackup:"",password:t},function(e){let a=JSON.parse(e);if(!0===a.status){var o=new XMLHttpRequest,r=(new Date).getTime();filename=a.filename,namefile=a.name,o.addEventListener("readystatechange",function(e){2==o.readyState&&200==o.status?(document.querySelector("#download-button").style.display="none",document.querySelector("#download-button").setAttribute("disabled","disabled"),document.querySelector("#save-file").style.display="none",document.querySelector(".showpassword").style.display="none",document.querySelector("#btn-back").style.display="none",document.querySelector(".showprogress").style.display="block"):3==o.readyState||4==o.readyState&&(_OBJECT_URL=URL.createObjectURL(o.response),document.querySelector(".showprogress").style.display="none",document.querySelector("#save-file").setAttribute("href",_OBJECT_URL),document.querySelector("#save-file").setAttribute("download",namefile),document.querySelector("#save-file").style.display="block",document.querySelector(".progress").style.display="none",$.post(`${baseurl}`,{deletefile:"",filename:filename,password:t},function(e){}),document.querySelector("#btn-back").style.display="block",document.querySelector("#btn-back").addEventListener("click",function(e){window.location.reload()}),document.querySelector("#download-button").removeAttribute("disabled"))}),o.addEventListener("progress",function(e){var t=e.loaded/e.total*100,a=((new Date).getTime()-r)/1e3,o=e.loaded/a,s=o/1024;s=Math.floor(s);var n=(e.total-e.loaded)/o,i=n%60,l=n/60;i=Math.floor(i),l=Math.floor(l),document.querySelector(".progress-bar").style.width=t+"%",document.querySelector(".progress-bar").innerHTML=parseFloat(t).toFixed(2)+"%",document.querySelector(".progress-text").innerHTML=convertSpeed(o)+" / s<br>"+(l>0?l+" min ":"")+i+" sec remaining"}),o.responseType="blob",o.open("get",filename),o.send()}else toastr.error(a.response,"Warning"),document.querySelector("#download-button").removeAttribute("disabled")})});"confirmation"===page&&"download"===act&&(document.querySelector("#cekzip").addEventListener("click",function(e){0==this.value?this.value=1:this.value=0}),document.querySelector("#download-button").addEventListener("click",function(e){e.preventDefault();var t=$(".password").val(),a=document.getElementById("cekzip").value,o=document.getElementById("file").value;document.querySelector("#download-button").setAttribute("disabled","disabled"),$.post(`${baseurl}`,{download:"",password:t,iszip:a,file:o},function(e){let a=JSON.parse(e);if(!0===a.status){var o=new XMLHttpRequest,r=(new Date).getTime();filename=a.filename,namefile=a.name,o.addEventListener("readystatechange",function(e){2==o.readyState&&200==o.status?(document.querySelector("#download-button").style.display="none",document.querySelector("#save-file").style.display="none",document.querySelector(".showpassword").style.display="none",document.querySelector("#btn-back").style.display="none",document.querySelector(".showprogress").style.display="block",document.querySelector("#download-button").setAttribute("disabled","disabled")):3==o.readyState||4==o.readyState&&(_OBJECT_URL=URL.createObjectURL(o.response),document.querySelector(".showprogress").style.display="none",document.querySelector("#save-file").setAttribute("href",_OBJECT_URL),document.querySelector("#save-file").setAttribute("download",namefile),document.querySelector("#save-file").style.display="block",document.querySelector(".progress").style.display="none",$.post(`${baseurl}`,{deletefile:"",filename:filename,password:t},function(e){}),document.querySelector("#btn-back").style.display="block",document.querySelector("#btn-back").addEventListener("click",function(e){window.location.reload()}))}),o.addEventListener("progress",function(e){var t=e.loaded/e.total*100,a=((new Date).getTime()-r)/1e3,o=e.loaded/a,s=o/1024;s=Math.floor(s);var n=(e.total-e.loaded)/o,i=n%60,l=n/60;i=Math.floor(i),l=Math.floor(l),document.querySelector(".progress-bar").style.width=t+"%",document.querySelector(".progress-bar").innerHTML=parseFloat(t).toFixed(2)+"%",document.querySelector(".progress-text").innerHTML=convertSpeed(o)+" / s<br>"+(l>0?l+" min ":"")+i+" sec remaining"}),o.responseType="blob",o.open("get",filename),o.send()}else toastr.error(a.response,"Warning"),document.querySelector("#download-button").removeAttribute("disabled")})}));
