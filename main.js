function convertSpeed(e){var t=-1;do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(1)+" "+["KB","MB","GB","TB","PB","EB","ZB","YB"][t]}function formatFileSize(e,t){if(0==e)return"0 Bytes";var r=t||2,o=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,o)).toFixed(r))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][o]}var codemirrorEditor,_OBJECT_URL,filename;(parsingurl=new URLSearchParams(window.location.search),page=parsingurl.get("page"),act=parsingurl.get("act"),dir=parsingurl.get("dir"),type=parsingurl.get("type"),file=parsingurl.get("file"),$(".btn-backup").on("click",function(e){e.preventDefault();var t=$(this);if(files=[],$(".cekfiles").each(function(){!0===$(this).is(":checked")&&files.push($(this).val())}),0===files.length)return toastr.error("Belum ada file yang dipilih!","Warning"),!1;t.html('<i class="fa fa-circle-o-notch fa-spin"></i> Proses Backup'),$("button").attr("disabled",!0),$.post(`${baseurl}`,{backup:"",files:files},function(e){let r=JSON.parse(e);!0===r.status?window.location.reload():(toastr.error(r.pesan,"Warning"),t.html('<i class="fa fa-database"></i> Backup'),$("button").removeAttr("disabled",!0))})}),$(".btn-copy").on("click",function(e){if(e.preventDefault(),files=[],$(".cekfiles").each(function(){!0===$(this).is(":checked")&&files.push($(this).val())}),0===files.length)return toastr.error("Belum ada file yang dipilih!","Warning"),!1;window.location.href=`${baseurl}?page=copy&dir=${dir}&files=${files.join("@")}`}),$(".btn-move").on("click",function(e){if(e.preventDefault(),files=[],$(".cekfiles").each(function(){!0===$(this).is(":checked")&&files.push($(this).val())}),0===files.length)return toastr.error("Belum ada file yang dipilih!","Warning"),!1;window.location.href=`${baseurl}?page=move&dir=${dir}&files=${files.join("@")}`}),$("#showpass").on("click",function(e){!0===$(this).is(":checked")?$(".pass").attr("type","text"):$(".pass").attr("type","password")}),"setting"===page&&$("#form-setting").on("submit",function(e){e.preventDefault();var t=$(this);$.ajax({url:`${baseurl}?page=simpan`,type:"post",data:t.serializeArray(),success:function(e){window.location.reload()}})}),loadListDirectory=(()=>{$(".list_directory").html('<div class="mt-3"><div class="box"></div><div class="box"></div><div class="box"></div></div>'),$.get(`${baseurl}?page=list`,{folder:folder},function(e){$(".list_directory").html(e)})}),"edit"!==page&&"confirmation"!==page&&"add"!==page&&loadListDirectory(),"edit"===page)&&($(".loading").show(),$.post(`${baseurl}`,{read_file:"",file:file},function(e){$(".loading").hide(),$("#codearea").fadeIn("slow").show(),document.querySelector("#codearea").value=window.atob(window.atob(window.atob(e))),codemirrorEditor=CodeMirror.fromTextArea(document.getElementById("codearea"),{lineNumbers:!0,theme:"monokai",matchBrackets:!0,mode:{name:"javascript",startOpen:!0},indentUnit:4,indentWithTabs:!0,lineWrapping:!0})}),$(window).bind("keydown",function(e){if(e.ctrlKey||e.metaKey)switch(String.fromCharCode(e.which).toLowerCase()){case"s":e.preventDefault();var t=codemirrorEditor.getValue(),r=$(".pathfile").val(),o=$(".password").val(),a=new XMLHttpRequest;if(""===o.trim())return toastr.error("Password can't empty!","Warning"),!1;$("button").html('<i class="fa fa-circle-o-notch fa-spin"></i> Saving...').attr("disabled",!0),a.onload=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.response);1==e.status?toastr.success(e.response,"Information"):toastr.error(e.response,"Warning"),$("button").html('<i class="fa fa-save"></i> Simpan').removeAttr("disabled")}else alert("Target server reached, but it returned an error")},a.onerror=function(){},a.open("POST",baseurl,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send("savefile=&path="+r+"&password="+o+"&content="+encodeURIComponent(t))}}),$(".btn-simpan-file").on("click",function(e){e.preventDefault();var t=$(this),r=codemirrorEditor.getValue(),o=$(".pathfile").val(),a=$(".password").val(),n=new XMLHttpRequest;if(""===a.trim())return toastr.error("Password can't empty!","Warning"),!1;$(this).html('<i class="fa fa-circle-o-notch fa-spin"></i> Saving...').attr("disabled",!0),n.onload=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.response);1==e.status?toastr.success(e.response,"Information"):toastr.error(e.response,"Warning"),t.html('<i class="fa fa-save"></i> Simpan').removeAttr("disabled")}else alert("Target server reached, but it returned an error")},n.onerror=function(){},n.open("POST",baseurl,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send("savefile=&path="+o+"&password="+a+"&content="+encodeURIComponent(r))}));("add"===page&&"folder"===type&&$("#form-add-folder").on("submit",function(e){e.preventDefault();var t=$(this);$("button").attr("disabled",!0),$.ajax({url:`${baseurl}`,type:"post",data:t.serializeArray(),dataType:"json",success:function(e){!0===e.status?(toastr.success(e.pesan,"Success"),setTimeout(()=>{window.history.back()},1e3)):(toastr.error(e.pesan,"Warning"),$("button").removeAttr("disabled"))}})}),"add"===page&&"file"===type)&&(codemirrorEditor=CodeMirror.fromTextArea(document.getElementById("codearea"),{lineNumbers:!0,theme:"monokai",matchBrackets:!0,mode:{name:"javascript",startOpen:!0},indentUnit:4,indentWithTabs:!0,lineWrapping:!0}),$("#form-add-file").on("submit",function(e){e.preventDefault();var t=new FormData(this),r=codemirrorEditor.getValue();t.append("content",r),$("button").attr("disabled",!0),$.ajax({url:`${baseurl}`,type:"post",data:t,processData:!1,contentType:!1,dataType:"json",success:function(e){!0===e.status?(toastr.success(e.pesan,"Success"),setTimeout(()=>{window.history.back()},1e3)):(toastr.error(e.pesan,"Warning"),$("button").removeAttr("disabled"))}})}));("confirmation"===page&&$("form").on("submit",function(e){e.preventDefault();var t=$(this),r=$(this).find("button").text(),o=$(this).find("button");o.html(`<i class="fa fa-circle-o-notch fa-spin"></i> ${r}`).attr("disabled",!0),$.ajax({url:`${baseurl}`,type:"post",data:t.serializeArray(),dataType:"json",success:function(e){!0===e.status?(toastr.success(e.pesan,"Success"),setTimeout(()=>{window.history.back()},1e3)):(toastr.error(e.pesan,"Warning"),o.html(`${r}`).removeAttr("disabled"))}})}),"move"!==page&&"copy"!==page||$("form").on("submit",function(e){e.preventDefault();var t=$(this),r=$(this).find("button").text(),o=$(this).find("button");o.html(`<i class="fa fa-circle-o-notch fa-spin"></i> ${r}`).attr("disabled",!0),$.ajax({url:`${baseurl}`,type:"post",data:t.serializeArray(),dataType:"json",success:function(e){!0===e.status?(toastr.success(e.pesan,"Success"),setTimeout(()=>{window.history.back()},1e3)):(toastr.error(e.pesan,"Warning"),o.html(`${r}`).removeAttr("disabled"))}})}),"downloadbackup"===page)&&document.querySelector("#download-button").addEventListener("click",function(e){e.preventDefault();var t=$(".password").val();document.querySelector("#download-button").setAttribute("disabled","disabled"),$.post(`${baseurl}`,{downloadbackup:"",password:t},function(e){let r=JSON.parse(e);if(!0===r.status){var o=new XMLHttpRequest,a=(new Date).getTime();filename=r.filename,namefile=r.name,$(".show-download").fadeIn("slow").show(),$(".show-download a").attr("href",filename),o.addEventListener("readystatechange",function(e){if(2==o.readyState&&200==o.status)document.querySelector("#download-button").style.display="none",document.querySelector("#download-button").setAttribute("disabled","disabled"),document.querySelector("#save-file").style.display="none",document.querySelector(".showpassword").style.display="none",document.querySelector("#btn-back").style.display="none",document.querySelector(".showprogress").style.display="block";else if(3==o.readyState);else if(4==o.readyState)try{_OBJECT_URL=URL.createObjectURL(o.response),document.querySelector(".showprogress").style.display="none",document.querySelector("#save-file").setAttribute("href",_OBJECT_URL),document.querySelector("#save-file").setAttribute("download",namefile),document.querySelector("#save-file").style.display="block",document.querySelector(".progress").style.display="none",$.post(`${baseurl}`,{deletefile:"",filename:filename,password:t},function(e){}),document.querySelector("#btn-back").style.display="block",document.querySelector("#btn-back").addEventListener("click",function(e){window.location.reload()})}catch(e){toastr.error(e,"Warning"),document.querySelector("#btn-back").style.display="none",document.querySelector("#download-button").style.display="block",document.querySelector("#download-button").removeAttribute("disabled"),document.querySelector(".showprogress").style.display="none"}}),o.addEventListener("progress",function(e){var t=e.loaded/e.total*100,r=((new Date).getTime()-a)/1e3,o=e.loaded/r,n=o/1024;n=Math.floor(n);var s=(e.total-e.loaded)/o,i=s%60,l=s/60;i=Math.floor(i),l=Math.floor(l),document.querySelector(".progress-bar").style.width=t+"%",document.querySelector(".progress-bar").innerHTML=parseFloat(t).toFixed(2)+"%",document.querySelector(".progress-text").innerHTML=convertSpeed(o)+" / s<br>"+(l>0?l+" min ":"")+i+" sec remaining"}),o.responseType="blob",o.open("get",filename),o.send()}else toastr.error(r.response,"Warning"),document.querySelector("#download-button").removeAttribute("disabled")})});"confirmation"===page&&"download"===act&&(document.querySelector("#cekzip").addEventListener("click",function(e){0==this.value?this.value=1:this.value=0}),document.querySelector("#download-button").addEventListener("click",function(e){e.preventDefault();var t=$(".password").val(),r=document.getElementById("cekzip").value,o=document.getElementById("file").value;document.querySelector("#download-button").setAttribute("disabled","disabled"),$.post(`${baseurl}`,{download:"",password:t,iszip:r,file:o},function(e){let r=JSON.parse(e);if(!0===r.status){var o=new XMLHttpRequest,a=(new Date).getTime();filename=r.filename,namefile=r.name,$(".show-download").fadeIn("slow").show(),$(".show-download a").attr("href",filename),o.addEventListener("readystatechange",function(e){if(2==o.readyState&&200==o.status)document.querySelector("#download-button").style.display="none",document.querySelector("#save-file").style.display="none",document.querySelector(".showpassword").style.display="none",document.querySelector("#btn-back").style.display="none",document.querySelector(".showprogress").style.display="block",document.querySelector("#download-button").setAttribute("disabled","disabled");else if(3==o.readyState)console.log("error");else if(4==o.readyState)try{_OBJECT_URL=URL.createObjectURL(o.response),document.querySelector(".showprogress").style.display="none",document.querySelector("#save-file").setAttribute("href",_OBJECT_URL),document.querySelector("#save-file").setAttribute("download",namefile),document.querySelector("#save-file").style.display="block",document.querySelector(".progress").style.display="none",$.post(`${baseurl}`,{deletefile:"",filename:filename,password:t},function(e){}),document.querySelector("#btn-back").style.display="block",document.querySelector("#btn-back").addEventListener("click",function(e){window.location.reload()})}catch(e){toastr.error(e,"Warning"),document.querySelector("#btn-back").style.display="none",document.querySelector("#download-button").style.display="block",document.querySelector("#download-button").removeAttribute("disabled"),document.querySelector(".showprogress").style.display="none"}}),o.addEventListener("progress",function(e){var t=e.loaded/e.total*100,r=((new Date).getTime()-a)/1e3,o=e.loaded/r,n=o/1024;n=Math.floor(n);var s=(e.total-e.loaded)/o,i=s%60,l=s/60;i=Math.floor(i),l=Math.floor(l),document.querySelector(".progress-bar").style.width=t+"%",document.querySelector(".progress-bar").innerHTML=parseFloat(t).toFixed(2)+"%",document.querySelector(".progress-text").innerHTML=convertSpeed(o)+" / s<br>"+(l>0?l+" min ":"")+i+" sec remaining"}),o.responseType="blob",o.open("get",filename),o.send()}else toastr.error(r.response,"Warning"),document.querySelector("#download-button").removeAttribute("disabled")})}));if("add"===page&&"upload"===type){function hideSub(){$("#deleteZip").prop("checked",!1),$("#sub").hasClass("hidden")?$("#sub").removeClass("hidden"):$("#sub").addClass("hidden")}function checkOptions(e){if($("#extractZip").is(":checked")){if($("#deleteZip").is(":checked"))t='{"fileName":"'+e+'","deleteXpo":"true"}';else var t='{"fileName":"'+e+'"}';document.querySelector("#submit-btn").innerHTML='<i class="fa fa-circle-o-notch fa-spin"></i> Proses Ekstrak',document.querySelector("#submit-btn").setAttribute("disabled","disabled"),$.ajax({url:baseurl,data:{unzip:"",path:path,Xpo:t},method:"POST",success:function(e){"success"==(e=JSON.parse(e)).unzip?toastr.success("Finished"):toastr.error("Uploaded But error occured while extracting","Warning"),document.querySelector("#submit-btn").innerHTML="Upload",document.querySelector("#submit-btn").removeAttribute("disabled"),document.querySelector("#progress-bar").style.display="none",document.querySelector(".progress-bar").style.width=0,document.querySelector(".progress-bar").innerHTML="",document.querySelector(".info_size").innerHTML=""},error:function(e){alert("Failed"),console.log(e),document.querySelector("#submit-btn").innerHTML="Upload",document.querySelector("#submit-btn").removeAttribute("disabled"),document.querySelector("#progress-bar").style.display="none",document.querySelector(".progress-bar").style.width=0,document.querySelector(".progress-bar").innerHTML="",document.querySelector(".info_size").innerHTML=""}})}else toastr.success("Finished"),document.querySelector("#submit-btn").innerHTML="Upload",document.querySelector("#submit-btn").removeAttribute("disabled"),document.querySelector("#progress-bar").style.display="none",document.querySelector(".progress-bar").style.width=0,document.querySelector(".progress-bar").innerHTML="",document.querySelector(".info_size").innerHTML=""}path=document.querySelector(".path").value,$(function(){$(document).on("change",":file",function(){var e=$(this),t=e.get(0).files?e.get(0).files.length:1,r=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[t,r])}),$(document).ready(function(){$(":file").on("fileselect",function(e,t,r){var o=$(this).parents(".input-group").find(":text"),a=t>1?t+" files selected":r;o.length?o.val(a):a&&alert(a)})})}),function(){function e(e){return document.getElementById(e)}var t,r,o;if((o=document.createElement("input")).setAttribute("type","file"),"object"==typeof o.files){var a=524288,n=[];function s(e){return Math.ceil(e.size/a)}window.onload=function(){t=e("formUpload");var o=document.querySelector(".formUpload-file");for(i in o)if("object"==typeof o&&"file"==o.getAttribute("type")){var d=o;break}t.reset(),t.onsubmit=function(o){var s;o.preventDefault(),document.querySelector("#submit-btn").innerHTML='<i class="fa fa-circle-o-notch fa-spin"></i> Proses Upload',document.querySelector("#submit-btn").setAttribute("disabled","disabled"),function o(s,i,d){if(i>=d)return t.reset(),n=[],!1;var c=n["data-start"];void 0===c&&(c=0),c>0&&c++;for(var u=0,p=0;p<c;p++){var u=u+a;u>s[i].size&&(u=s[i].size)}!function t(o,n,s,i,d,c){if(void 0!==o){void 0===n&&(console.log("index:: "+n),n=0,console.log("index:: "+n));var u=s+a;u>o.size&&(u=o.size),function(e,t,r,o){var a;a=e.webkitSlice?e.webkitSlice(t,r):e.mozSlice?e.mozSlice(t,r):e.slice(t,r),e.webkitSlice?l(a,function(e){o(e)}):o(a)}(o,s,u,function(a){var l=new FileReader;l.onload=function(l){for(var p=l.target?l.target:l.srcElement,f="",m=new Uint8Array(p.result),b=m.byteLength,y=0;y<b;y++)f+=String.fromCharCode(m[y]);var h=md5(f);f=void 0;var g=new XMLHttpRequest;g.onreadystatechange=function(){if(4==g.readyState){console.log(g.response);var a=JSON.parse(g.response);if(void 0!==typeof a.response&&!0!==a.response)return toastr.error(a.response,"Warning"),!1;void 0!==typeof a.error&&"E_HASH"===a.error?window.setTimeout(function(){t(o,n,s,i,d,c)},1e3):(r==a.filename&&(e("progress-bar"),document.querySelector("#progress-bar").style.display="flex",document.querySelector(".progress-bar").style.width=parseFloat(a.percent).toFixed(2)+"%",document.querySelector(".progress-bar").innerHTML=parseFloat(a.percent).toFixed(2)+"%",document.querySelector(".info_size").innerHTML=`<span>${a.upload_size} dari ${a.total_size}</span>`,100==a.percent&&(console.log("Finished"),hideSub(),checkOptions(r))),++n<i?window.setTimeout(function(){t(o,n,u,i,d,c)},100):c())}},void 0!==n&&null!=n||(console.log("index:: "+n),n=0,console.log("index:: "+n)),g.open("post",baseurl+"?page=upload",!0),g.setRequestHeader("X-File-Name",o.name),g.setRequestHeader("X-Index",n),g.setRequestHeader("X-Total",i),g.setRequestHeader("X-Hash",h),g.setRequestHeader("X-Path",path),g.setRequestHeader("X-Size",d),g.send(a)},l.readAsArrayBuffer(a)})}else console.log("stop")}(s[i],c,u,n["data-end"],n["data-size"],function(){o(s,++i,d)})}(s=d.files,0,s.length)},d.onchange=function(e){var t=(e.target?e.target:e.srcElement).files;for(var o in t)if("object"==typeof t[o]){var a=!1,i=document.querySelector(".formUpload-file");if(i.setAttribute("data-name",t[o].name),i.setAttribute("data-end",s(t[o])),"function"==typeof i.getAttribute){r=i.getAttribute("data-name"),Data_name=r;var l=s(t[o]);if(r==t[o].name&&l==i.getAttribute("data-end")){var d={"data-start":i.getAttribute("data-start"),"data-end":i.getAttribute("data-end"),"data-size":t[o].size};n=d,a=!0}}if(!1===a){d={"data-start":0,"data-end":s(t[o]),"data-size":0};n=d}}}};var l=function(e,t){var r,o=window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder;if(void 0!==o){var a=new o;a.append(e),r=a.getBlob()}else r=new Blob([e]);var n=new FileReader;n.onload=function(e){var r=e.target?e.target:e.srcElement;t(r.result)},n.readAsArrayBuffer(r)}}else window.onload=function(){t=e("formUpload");document.querySelector(".formUpload-file");t.reset(),t.onsubmit=function(e){var t=document.createElement("img");t.setAttribute("src","loading.gif"),t.setAttribute("alt","loading"),this.appendChild(t)},file_input.onchange=function(e){var t="File selected";void 0!==typeof e&&(e.preventDefault(),t=(e.target?e.target:e.srcElement).value||"File selected");for(var r=document.getElementById("toupload").getElementsByTagName("ul")[0];r.hasChildNodes();)r.removeChild(r.firstChild);var o=document.createElement("li");o.appendChild(document.createTextNode(t)),r.appendChild(o)}}}()}$("#login").on("submit",function(e){e.preventDefault();var t=$(this),r=$(this).find("button").text(),o=$(this).find("button");o.html(`<i class="fa fa-circle-o-notch fa-spin"></i> ${r}`).attr("disabled",!0),$.ajax({url:`${baseurl}`,type:"post",data:t.serializeArray(),dataType:"json",success:function(e){!0===e.status?(toastr.success(e.pesan,"Success"),setTimeout(()=>{window.location.reload()},1e3)):(toastr.error(e.pesan,"Warning"),o.html(`${r}`).removeAttr("disabled"))}})});
